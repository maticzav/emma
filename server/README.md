# emma server

> GraphQL Server and Github BOT definition.

## Flows

How the application behaves and responds to input on Github or via GraphQL API.

### Installation

Every Emma installation can end up in two ways;

1. User installs application in every repository,
1. User installs application in some repositories.

In both cases, the app should check every repository and start the [installation](#repository-installation)
process of a single repository.

### Repository Installation

Each repository installation follows the following steps to make publishing of your boilerplate as easy as possible.

1. Repository has no configuration files. [System creates a PR.](#setup-pr)
1. Repository has an invalid configuration file. [System will file an issue.](#configuration-issue)
1. Repository has a valid configuration.

##### Configuration Checks

Whenever a new repository is installing, we check the following properties.

1. Merge every valid configuration file in the root of repository into one configuration.
1. Resolve `globs` for boilerplate paths.
1. [Install Boilerplate](#boilerplate-installation).

If no configuration is found the system will file a [PR](#create-setup-pr).
If no paths match `globs` a [configuration issue](#configuration-issue) will be filed.

#### Setup PR

The setup PR tries to guess the configuration your repository should use. It creates a new branch
named `emma/setup` and files a PR with the analysis of the current setup. Changing the configuration
in the branch should result in change of analysis.

```
# Emma configuration

> This is an autogenerated pull request.

We are happy to see you decided to use Emma Boilerplates.
This PR contains everything you need to setup your Boilerplates.

Let us know if you need any help by openning an issue on
https://github.com/maticzav/emma

${analysis}
```

#### Configuration issue

Configuration issue is filed whenever something in configuration is not properly set.

1. Configuration doesn't meet the schema definition.
1. Globs don't match in folder.

Configuration issue filed by Emma should include concise description of what went wrong
and how to fix it.

#### Boilerplate configuration issue

Boilerplate configuration issue is created whenever there's a problem with one of the boilerplates
specified in the root configuration. Boilerplates are defined using `package.json` in the root of
themselves. They should include `name`, `description` and `private` property.

```json
{
  "name": "sample-boilerplate",
  "description": "This is a sample description, visible on the site",
  "private": false
}
```

> `private` repositories will be ignored. _They are not treated as wrongly configured boilerplate._

### Boilerplate Installation

Every time a boilerplate is installed we first check whether we can make it accessible to everyone or not.

1. Root of boilerplate should include `package.json` with required `name`, `description` and `private` properies.
1. Boilerplate has to be `public` (`{ private: false }`).
1. Bolerplate name must still be available. Otherwise file a boilerplate [configuration issue](#boilerplate-configuration-issue).

If all tests pass, the boilerplate is saved to Mongo and updated in Algolia.

## License

MIT @ Matic Zavadlal
